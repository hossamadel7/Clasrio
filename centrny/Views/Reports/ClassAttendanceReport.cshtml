@using Microsoft.Extensions.Localization
@inject IStringLocalizerFactory LocalizerFactory
@{
    var Localizer = LocalizerFactory.Create("Reports", System.Reflection.Assembly.GetExecutingAssembly().GetName().Name);
    ViewData["Title"] = Localizer["ClassAttendanceReport"];
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/css/ClassAttendanceReport.css" rel="stylesheet" />

<!-- JS Localization keys -->
<div id="js-localization"
     data-title="@Localizer["ClassAttendance"]"
     data-subtitle="@Localizer["MonitorSubtitle"]"
     data-teacher="@Localizer["Teacher"]"
     data-all-teachers="@Localizer["AllTeachers"]"
     data-subject="@Localizer["Subject"]"
     data-all-subjects="@Localizer["AllSubjects"]"
     data-date="@Localizer["Date"]"
     data-apply="@Localizer["Apply"]"
     data-clear="@Localizer["Clear"]"
     data-reset="@Localizer["ResetFilters"]"
     data-loading="@Localizer["LoadingAttendance"]"
     data-no-classes="@Localizer["NoClassesFound"]"
     data-no-classes-text="@Localizer["NoClassesMatch"]"
     data-enrolled="@Localizer["Enrolled"]"
     data-present="@Localizer["Present"]"
     data-absent="@Localizer["Absent"]"
     data-rate="@Localizer["Rate"]"
     data-attendance-rate="@Localizer["AttendanceRate"]"
     data-branch="@Localizer["Branch"]"
     data-hall="@Localizer["Hall"]"
     data-students="@Localizer["Students"]"
     data-attendance="@Localizer["Attendance"]"
     data-manage-attendance="@Localizer["ManageAttendance"]"
     data-pagination-info="@Localizer["PaginationInfo"]"
     data-loading-error-title="@Localizer["LoadingErrorTitle"]"
     data-loading-error-text="@Localizer["LoadingErrorText"]" />

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Clean Header -->
            <div class="attendance-header mb-3">
                <h1 class="attendance-title">
                    <i class="fas fa-clipboard-check me-2"></i>
                    <span id="attendance-title"></span>
                </h1>
                <p class="attendance-subtitle" id="attendance-subtitle"></p>
            </div>

            <!-- Compact Filter Panel -->
            <div class="enhanced-filter-panel mb-3">
                <div class="filter-body">
                    <form id="filterForm" class="filter-form">
                        @if (!ViewBag.IsTeacher)
                        {
                            <div class="filter-group">
                                <label for="teacherCode" class="filter-label" id="teacher-label"></label>
                                <select id="teacherCode" name="teacherCode" class="enhanced-select">
                                    <option value="">@Localizer["AllTeachers"]</option>
                                    @foreach (var teacher in ViewBag.Teachers)
                                    {
                                        <option value="@teacher.TeacherCode">@teacher.TeacherName</option>
                                    }
                                </select>
                            </div>
                        }

                        <div class="filter-group">
                            <label for="subjectCode" class="filter-label" id="subject-label"></label>
                            <select id="subjectCode" name="subjectCode" class="enhanced-select">
                                <option value="">@Localizer["AllSubjects"]</option>
                                @foreach (var subject in ViewBag.Subjects)
                                {
                                    <option value="@subject.SubjectCode">@subject.SubjectName</option>
                                }
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="classDate" class="filter-label" id="date-label"></label>
                            <input type="date" id="classDate" name="classDate" class="enhanced-input">
                        </div>

                        <div class="filter-actions">
                            <button type="submit" class="enhanced-btn enhanced-btn-primary" id="apply-btn">
                                <i class="fas fa-search me-1"></i><span id="apply-label"></span>
                            </button>
                            <button type="button" id="clearFilters" class="enhanced-btn enhanced-btn-secondary">
                                <i class="fas fa-times me-1"></i><span id="clear-label"></span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading-container" style="display: none;">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                </div>
                <p class="loading-text" id="loading-text"></p>
            </div>

            <!-- Classes Container -->
            <div id="attendanceContainer" class="enhanced-classes-container">
                <!-- Classes will be loaded here via AJAX -->
            </div>

            <!-- No Data Message -->
            <div id="noDataMessage" class="enhanced-no-data" style="display: none;">
                <div class="no-data-content">
                    <div class="no-data-icon">
                        <i class="fas fa-calendar-times"></i>
                    </div>
                    <h4 class="no-data-title" id="no-classes-title"></h4>
                    <p class="no-data-text" id="no-classes-text"></p>
                    <button id="clearFiltersBtn" class="enhanced-btn enhanced-btn-primary">
                        <i class="fas fa-refresh me-1"></i><span id="reset-label"></span>
                    </button>
                </div>
            </div>

            <!-- Pagination -->
            <nav id="paginationContainer" class="enhanced-pagination" style="display: none;">
                <div class="pagination-wrapper">
                    <div class="pagination-info">
                        <span id="paginationInfo" class="pagination-text">
                            <!-- Pagination info will be inserted here -->
                        </span>
                    </div>
                    <ul class="pagination-list" id="paginationLinks">
                        <!-- Pagination links will be inserted here -->
                    </ul>
                </div>
            </nav>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="~/js/ClassAttendanceReport.js"></script>
<script>
    // Localize all static labels on DOM ready
    $(document).ready(function () {
        function getJsString(key) {
            var el = document.getElementById('js-localization');
            return el ? (el.getAttribute('data-' + key) || '') : '';
        }
        $('#attendance-title').text(getJsString('title'));
        $('#attendance-subtitle').text(getJsString('subtitle'));
        $('#teacher-label').text(getJsString('teacher'));
        $('#subject-label').text(getJsString('subject'));
        $('#date-label').text(getJsString('date'));
        $('#apply-label').text(getJsString('apply'));
        $('#clear-label').text(getJsString('clear'));
        $('#loading-text').text(getJsString('loading'));
        $('#no-classes-title').text(getJsString('no-classes'));
        $('#no-classes-text').text(getJsString('no-classes-text'));
        $('#reset-label').text(getJsString('reset'));
    });
</script>