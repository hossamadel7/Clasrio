@using Microsoft.Extensions.Localization
@inject IStringLocalizerFactory LocalizerFactory
@{
    var Localizer = LocalizerFactory.Create("Reports", System.Reflection.Assembly.GetExecutingAssembly().GetName().Name);
    ViewData["Title"] = Localizer["ReportsDashboard"];
    var isTeacher = ViewBag.IsTeacher as bool? ?? false;
    var branchCode = ViewBag.BranchCode as int?;
    var rootCode = ViewBag.RootCode as int?;
}

<link href="~/css/styles-variables.css" rel="stylesheet" />
<link href="~/css/Hamody.css" rel="stylesheet" />
<style>
    /* Button color classes matching icon colors */
    .btn-report-primary {
        background: var(--primary-gradient-horizontal) !important;
        color: #fff !important;
    }

    .btn-report-info {
        background: var(--info-gradient) !important;
        color: #fff !important;
    }

    .btn-report-success {
        background: var(--success-gradient) ;
        color: #fff !important;
    }

    .btn-report-warning {
        background: var(--warning-gradient);
        color: #fff !important;
    }

    .btn-report-secondary {
        background: #636e72 !important;
        color: #fff !important;
    }

    .btn-report-muted {
        background: #b2bec3;
        color: #fff !important;
    }
    /* Optionally, for green earnings card */
    .btn-report-green {
        background: linear-gradient(90deg, #00b894 0%, #55efc4 100%) !important;
        color: #fff !important;
    }
</style>

<div class="container mt-4" style="max-width:1550px;">
    <!-- Unified Gradient Header -->
    <div class="questions-header">
        <h2>
            <i class="fas fa-chart-bar"></i> @Localizer["ReportsDashboard"]
        </h2>
        <p class="text-muted mt-2" style="font-size:1.2em;">
            @Localizer["ReportsDashboardSubtitle"]
        </p>
    </div>

    <div class="row">
        @if (!isTeacher)
        {
            <!-- Center Admin Reports -->
            <div class="col-12 mb-4">
                <h3 class="text-primary mb-3">
                    <i class="fas fa-building"></i> @Localizer["CenterManagementReports"]
                </h3>
            </div>

            <!-- Financial Reports (Primary) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-dollar-sign text-primary fa-2x"></i>
                            </div>
                            <span class="badge bg-primary">@Localizer["Revenue"]</span>
                        </div>
                        <h5 class="card-title">@Localizer["FinancialSummary"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["View"]:</small> @Localizer["FinancialSummaryDesc"]<br>
                            <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["FinancialSummaryFilters"]<br>
                            <small class="text-muted">@Localizer["Export"]:</small> @Localizer["ExportOptions"]
                        </p>
                        <a href="@Url.Action("FinancialSummary", "Reports")"
                           class="modern-btn w-100 btn-report-primary">
                            <i class="fas fa-chart-line"></i> @Localizer["ViewReport"]
                        </a>
                    </div>
                </div>
            </div>

            <!-- Student Enrollment Report (Info) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-users text-info fa-2x"></i>
                            </div>
                            <span class="badge bg-info">@Localizer["Students"]</span>
                        </div>
                        <h5 class="card-title">@Localizer["StudentEnrollment"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["View"]:</small> @Localizer["StudentEnrollmentDesc"]<br>
                            <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["StudentEnrollmentFilters"]<br>
                            <small class="text-muted">@Localizer["Includes"]:</small> @Localizer["StudentEnrollmentIncludes"]
                        </p>
                        <a href="@Url.Action("StudentEnrollmentReport", "Reports")"
                           class="modern-btn w-100 btn-report-info">
                            <i class="fas fa-user-graduate"></i> @Localizer["ViewReport"]
                        </a>
                    </div>
                </div>
            </div>

            <!-- Teacher Performance Report (Success) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-chalkboard-teacher text-success fa-2x"></i>
                            </div>
                            <span class="badge bg-success">@Localizer["Performance"]</span>
                        </div>
                        <h5 class="card-title">@Localizer["TeacherPerformance"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["View"]:</small> @Localizer["TeacherPerformanceDesc"]<br>
                            <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["TeacherPerformanceFilters"]<br>
                            <small class="text-muted">@Localizer["Metrics"]:</small> @Localizer["TeacherPerformanceMetrics"]
                        </p>
                        <a href="@Url.Action("TeacherPerformanceReport", "Reports")"
                           class="modern-btn w-100 btn-report-success">
                            <i class="fas fa-award"></i> @Localizer["ViewReport"]
                        </a>
                    </div>
                </div>
            </div>

            <!-- Exam Performance Report (Warning) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-clipboard-list text-warning fa-2x"></i>
                            </div>
                            <span class="badge bg-warning text-dark">@Localizer["Academic"]</span>
                        </div>
                        <h5 class="card-title">@Localizer["ExamPerformance"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["View"]:</small> @Localizer["ExamPerformanceDesc"]<br>
                            <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["ExamPerformanceFilters"]<br>
                            <small class="text-muted">@Localizer["Analytics"]:</small> @Localizer["ExamPerformanceAnalytics"]
                        </p>
                        <a href="@Url.Action("ExamPerformanceReport", "Reports")"
                           class="modern-btn w-100 btn-report-warning" style="color: #363636;">
                            <i class="fas fa-chart-pie"></i> @Localizer["ViewReport"]
                        </a>
                    </div>
                </div>
            </div>
        }

        @if (isTeacher)
        {
            <!-- Teacher Reports -->
            <div class="col-12 mb-4">
                <h3 class="text-primary mb-3">
                    <i class="fas fa-user-tie"></i> @Localizer["MyTeachingReports"]
                </h3>
            </div>

            <!-- My Classes Report (Primary) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-calendar-alt text-primary fa-2x"></i>
                            </div>
                            <span class="badge bg-primary">@Localizer["Classes"]</span>
                        </div>
                        <h5 class="card-title">@Localizer["MyClasses"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["View"]:</small> @Localizer["MyClassesDesc"]<br>
                            <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["MyClassesFilters"]<br>
                            <small class="text-muted">@Localizer["Includes"]:</small> @Localizer["MyClassesIncludes"]
                        </p>
                        <a href="@Url.Action("MyClassesReport", "Reports")"
                           class="modern-btn w-100 btn-report-primary">
                            <i class="fas fa-calendar-check"></i> @Localizer["ViewReport"]
                        </a>
                    </div>
                </div>
            </div>

            <!-- My Student Performance (Info) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-user-graduate text-info fa-2x"></i>
                            </div>
                            <span class="badge bg-info">@Localizer["Students"]</span>
                        </div>
                        <h5 class="card-title">@Localizer["MyStudents"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["View"]:</small> @Localizer["MyStudentsDesc"]<br>
                            <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["MyStudentsFilters"]<br>
                            <small class="text-muted">@Localizer["Includes"]:</small> @Localizer["MyStudentsIncludes"]
                        </p>
                        <a href="@Url.Action("MyStudentPerformance", "Reports")"
                           class="modern-btn w-100 btn-report-info">
                            <i class="fas fa-chart-line"></i> @Localizer["ViewReport"]
                        </a>
                    </div>
                </div>
            </div>

            <!-- My Earnings Report (Green) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-money-bill-wave" style="color:#00b894; font-size:2em"></i>
                            </div>
                            <span class="badge" style="background:linear-gradient(90deg,#00b894,#55efc4);">@Localizer["Earnings"]</span>
                        </div>
                        <h5 class="card-title">@Localizer["MyEarnings"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["View"]:</small> @Localizer["MyEarningsDesc"]<br>
                            <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["MyEarningsFilters"]<br>
                            <small class="text-muted">@Localizer["Breakdown"]:</small> @Localizer["MyEarningsBreakdown"]
                        </p>
                        <a href="@Url.Action("MyEarningsReport", "Reports")"
                           class="modern-btn w-100 btn-report-green">
                            <i class="fas fa-dollar-sign"></i> @Localizer["ViewReport"]
                        </a>
                    </div>
                </div>
            </div>
        }

        <!-- Common Reports Section -->
        <div class="col-12 mb-4 mt-4">
            <h3 class="text-primary mb-3">
                <i class="fas fa-clipboard-check"></i> @Localizer["AttendanceAndClassReports"]
            </h3>
        </div>

        <!-- Class Attendance Report (Secondary) -->
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <i class="fas fa-clipboard-check text-secondary fa-2x"></i>
                        </div>
                        <span class="badge bg-secondary">@Localizer["Attendance"]</span>
                    </div>
                    <h5 class="card-title">@Localizer["ClassAttendance"]</h5>
                    <p class="card-text">
                        <small class="text-muted">@Localizer["Compare"]:</small> @Localizer["ClassAttendanceDesc"]<br>
                        <small class="text-muted">@Localizer["FilterBy"]:</small> @Localizer["ClassAttendanceFilters"]<br>
                        <small class="text-muted">@Localizer["Shows"]:</small> @Localizer["ClassAttendanceShows"]
                    </p>
                    <a href="@Url.Action("ClassAttendanceReport", "Reports")"
                       class="modern-btn w-100 btn-report-secondary">
                        <i class="fas fa-list-check"></i> @Localizer["ViewReport"]
                    </a>
                </div>
            </div>
        </div>

        @if (!isTeacher)
        {
            <!-- Coming Soon Reports (Light/Muted) -->
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm border-0" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <i class="fas fa-building text-muted fa-2x"></i>
                            </div>
                            <span class="badge bg-light text-dark">@Localizer["ComingSoon"]</span>
                        </div>
                        <h5 class="card-title text-muted">@Localizer["BranchPerformance"]</h5>
                        <p class="card-text">
                            <small class="text-muted">@Localizer["Compare"]:</small> @Localizer["BranchPerformanceDesc"]<br>
                            <small class="text-muted">@Localizer["Metrics"]:</small> @Localizer["BranchPerformanceMetrics"]<br>
                            <small class="text-muted">@Localizer["Period"]:</small> @Localizer["BranchPerformancePeriod"]
                        </p>
                        <button class="modern-btn w-100 btn-report-muted" disabled>
                            <i class="fas fa-chart-bar"></i> @Localizer["ComingSoon"]
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Quick Stats Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-primary mb-3">
                <i class="fas fa-tachometer-alt"></i> @Localizer["QuickStatistics"]
            </h3>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center" style="border-radius: 18px;">
                <div class="card-body">
                    <div class="text-primary mb-2">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <h5 class="card-title">@Localizer["ActiveStudents"]</h5>
                    <p class="text-primary fs-4" id="totalStudents">Loading...</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center" style="border-radius: 18px;">
                <div class="card-body">
                    <div class="text-success mb-2">
                        <i class="fas fa-calendar-check fa-2x"></i>
                    </div>
                    <h5 class="card-title">@Localizer["ClassesThisMonth"]</h5>
                    <p class="text-success fs-4" id="monthlyClasses">Loading...</p>
                </div>
            </div>
        </div>
        @if (!isTeacher)
        {
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card text-center" style="border-radius: 18px;">
                    <div class="card-body">
                        <div class="text-info mb-2">
                            <i class="fas fa-dollar-sign fa-2x"></i>
                        </div>
                        <h5 class="card-title">@Localizer["MonthlyRevenue"]</h5>
                        <p class="text-info fs-4" id="monthlyRevenue">Loading...</p>
                    </div>
                </div>
            </div>
        }
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-center" style="border-radius: 18px;">
                <div class="card-body">
                    <div class="text-warning mb-2">
                        <i class="fas fa-percentage fa-2x"></i>
                    </div>
                    <h5 class="card-title">@Localizer["AttendanceRate"]</h5>
                    <p class="text-warning fs-4" id="attendanceRate">Loading...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Load quick statistics
    $(document).ready(function() {
        loadQuickStats();
    });

    function loadQuickStats() {
        // Show placeholder values for now
        setTimeout(function() {
            $('#totalStudents').text('1,248');
            $('#monthlyClasses').text('156');
            $('#monthlyRevenue').text('$12,450');
            $('#attendanceRate').text('87.5%');
        }, 1000);

        // TODO: Implement actual AJAX call to GetDashboardStats
        /*
        $.ajax({
            url: '@Url.Action("GetDashboardStats", "Reports")',
            type: 'GET',
            success: function(data) {
                $('#totalStudents').text(data.totalStudents.toLocaleString());
                $('#monthlyClasses').text(data.monthlyClasses);
                if (!@isTeacher.ToString().ToLower()) {
                    $('#monthlyRevenue').text('$' + data.monthlyRevenue.toLocaleString());
                }
                $('#attendanceRate').text(data.attendanceRate.toFixed(1) + '%');
            },
            error: function() {
                $('#totalStudents').text('Error');
                $('#monthlyClasses').text('Error');
                $('#monthlyRevenue').text('Error');
                $('#attendanceRate').text('Error');
            }
        });
        */
    }
</script>