@using SubjectResource = centrny.Resources.Subject
@{
    ViewBag.Title = SubjectResource.Subject_ListTitle;
}
<link rel="stylesheet" href="~/css/Hamody.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="security-header mb-0 questions-header">
    <h2>
        <i class="bi bi-book"></i>
        @SubjectResource.Subject_ListTitle
    </h2>
</div>

<div class="security-panel-card" style="max-width: 1000px;">
    <!-- Add Subject Button -->
    <div style="margin-bottom: 22px; text-align: center;">
        <button id="add-subject-btn" class="modern-btn success-btn">@SubjectResource.Subject_AddBtn</button>
    </div>

    <!-- Modal for Add/Edit Subject -->
    <div id="addSubjectModal" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <div class="modal-header">
                <span id="modalTitle" style="font-weight:600;font-size:1.15rem;">@SubjectResource.Subject_AddModalTitle</span>
                <span id="closeModal" style="cursor:pointer;font-size:1.4rem;">&times;</span>
            </div>
            <form id="addSubjectForm">
                <input type="hidden" id="subjectCode" name="subjectCode" />
                <div class="form-group">
                    <label for="subjectName">@SubjectResource.Subject_NameLabel</label>
                    <input type="text" id="subjectName" name="subjectName" required maxlength="100" />
                </div>
                <div class="form-group">
                    <label for="isPrimary">@SubjectResource.Subject_IsPrimaryLabel</label>
                    <select id="isPrimary" name="isPrimary" required>
                        <option value="true">@SubjectResource.Subject_Yes</option>
                        <option value="false">@SubjectResource.Subject_No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="yearCode">@SubjectResource.Subject_YearLabel</label>
                    <select id="yearCode" name="yearCode" required>
                        <option value="">@SubjectResource.Subject_LoadingYears</option>
                    </select>
                </div>
                <div id="addSubjectError" style="color:#c00; margin-bottom:10px;"></div>
                <button type="submit" class="modern-btn success-btn" style="width:100%;">@SubjectResource.Subject_Submit</button>
            </form>
        </div>
    </div>

    <!-- Modal for Add Teacher to Subject -->
    <div id="addTeacherToSubjectModal" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <div class="modal-header">
                <span style="font-weight:600;font-size:1.15rem;">@SubjectResource.Subject_AssignTeacherToSubjectTitle</span>
                <span id="closeAddTeacherToSubjectModal" style="cursor:pointer;font-size:1.4rem;">&times;</span>
            </div>
            <form id="addTeacherToSubjectForm">
                <div class="form-group">
                    <label>@SubjectResource.Subject_NameLabel</label>
                    <input type="text" id="addTeacherSubjectName" readonly />
                </div>
                <div class="form-group">
                    <label>@SubjectResource.Subject_TeacherLabel</label>
                    <select id="addTeacherTeacherCode" required></select>
                </div>
                <div class="form-group">
                    <label>@SubjectResource.Subject_BranchLabel</label>
                    <select id="addTeacherBranchCode" required></select>
                </div>
                <div class="form-group">
                    <label>@SubjectResource.Subject_CenterPercentageLabel</label>
                    <input type="number" step="0.01" id="addTeacherCenterPercentage" />
                </div>
                <div class="form-group">
                    <label>@SubjectResource.Subject_CenterAmountLabel</label>
                    <input type="number" step="0.01" id="addTeacherCenterAmount" />
                </div>
                <input type="hidden" id="addTeacherYearCode" />
                <input type="hidden" id="addTeacherEduYearCode" />
                <button type="submit" class="modern-btn success-btn" style="width:100%;">@SubjectResource.Subject_AssignTeacher</button>
            </form>
        </div>
    </div>
    <!-- Remove inline style and use proper CSS for centering and sizing -->
    <div class="subject-table-container">
        <table class="gradient-table">
            <thead>
                <tr>
                    <th>@SubjectResource.Subject_NameLabel</th>
                    <th>@SubjectResource.Subject_IsPrimary</th>
                    <th>@SubjectResource.Subject_YearName</th>
                    <th>@SubjectResource.Subject_Actions</th>
                </tr>
            </thead>
            <tbody id="subject-body">
                <!-- JS will populate this, including show/hide teacher rows -->
            </tbody>
        </table>
        <div id="subject-message" style="margin-top:20px;color:#b33c3c;font-weight:600;"></div>
    </div>
</div>

<!-- Add/override CSS for button row and secondary button design -->
<style>
    :root {
        --secondary-gradient: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
    }

    .subject-table-container {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }

    .gradient-table {
        margin: 0 auto;
        min-width: 900px;
        max-width: 1200px;
        width: auto;
    }

    .subject-btn-row {
        display: flex;
        gap: 0.5em;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }

    /* Modern button base style */
    .modern-btn {
        font-weight: 600 !important;
        padding: 0.65rem 1.3rem !important;
        border-radius: var(--border-radius, 18px) !important;
        border: none !important;
        color: #fff !important;
        box-shadow: 0 2px 8px rgba(108, 92, 231, 0.10) !important;
        font-size: 1rem !important;
        cursor: pointer !important;
        margin-right: 0.4rem !important;
        transition: transform 0.16s, box-shadow 0.16s !important;
        display: inline-flex !important;
        align-items: center !important;
        gap: 0.5em !important;
        background: var(--primary-gradient) !important;
    }

        .modern-btn.success-btn {
            background: var(--success-gradient) !important;
        }

        .modern-btn.delete-btn {
            background: var(--danger-gradient) !important;
        }

        .modern-btn.edit-btn {
            background: linear-gradient(135deg, #55a3ff 0%, #00b894 100%) !important;
        }

        /* Secondary button (Show Teachers) */
        .modern-btn.secondary-btn {
            background: var(--secondary-gradient) !important;
            color: #fff !important;
        }

        .modern-btn:hover, .modern-btn:focus {
            box-shadow: var(--shadow-lg, 0 8px 36px rgba(108, 92, 231, 0.18)) !important;
            transform: scale(1.05) !important;
        }
</style>

@section Scripts {
    <script>
        // Localized JS variables
        const editTitle = '@SubjectResource.Subject_EditModalTitle';
        const addTitle = '@SubjectResource.Subject_AddModalTitle';
        const yesText = '@SubjectResource.Subject_Yes';
        const noText = '@SubjectResource.Subject_No';
        const loadingYearsText = '@SubjectResource.Subject_LoadingYears';
        const noActiveYearsText = '@SubjectResource.Subject_NoActiveYears';
        const errorLoadingYearsText = '@SubjectResource.Subject_ErrorLoadingYears';
        const pleaseFillFieldsText = '@SubjectResource.Subject_PleaseFillFields';
        const couldNotAddText = '@SubjectResource.Subject_CouldNotAdd';
        const couldNotEditText = '@SubjectResource.Subject_CouldNotEdit';
        const couldNotDeleteText = '@SubjectResource.Subject_CouldNotDelete';
        const deleteConfirmText = '@SubjectResource.Subject_DeleteConfirm';
        const unauthorizedText = '@SubjectResource.Subject_Unauthorized';
        const notFoundText = '@SubjectResource.Subject_NotFound';
        const noSubjectsText = '@SubjectResource.Subject_NoSubjects';
        const errorLoadingText = '@SubjectResource.Subject_ErrorLoading';
        const closeText = '@SubjectResource.Subject_Close';
        const assignTeacherText = '@SubjectResource.Subject_AssignTeacher';
        const processingText = '@SubjectResource.Subject_Processing';
        const addTeacherText = '@SubjectResource.Subject_AddTeacher';
        const showTeachersText = '@SubjectResource.Subject_ShowTeachers';
        const couldNotAssignTeacherText = '@SubjectResource.Subject_CouldNotAssignTeacher';
        const noTeachersAssignedText = '@SubjectResource.Subject_NoTeachersAssigned';
    </script>
    <script src="~/js/SubjectManagement.js"></script>
}