@using Microsoft.Extensions.Localization
@using System.Globalization
@inject IStringLocalizerFactory LocalizerFactory
@{
    var Localizer = LocalizerFactory.Create("Question", System.Reflection.Assembly.GetExecutingAssembly().GetName().Name);
    ViewData["Title"] = Localizer["Title"];
    Layout = "_Layout";
    var isArabic = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName == "ar";
    var htmlLang = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;
    var htmlDir = isArabic ? "rtl" : "ltr";
}
<!DOCTYPE html>
<html lang="@htmlLang" dir="@htmlDir">
<head>
    <!-- Your existing head content stays the same -->
    <meta charset="utf-8" />
    <title>@ViewData["Title"]</title>
    @if (isArabic)
    {
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.rtl.min.css" rel="stylesheet" />
    }
    else
    {
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" />
    }
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <link href="~/css/Hamody.css" rel="stylesheet" />
    <style>
        /* Your existing styles stay the same */
        :root {
            --primary-gradient: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            --primary-gradient-horizontal: linear-gradient(90deg, #012852 0%, #5982ff 100%);
            --primary-gradient-light: linear-gradient(135deg, #a29bfe33 0%, #6c5ce722 100%);
            --success-gradient: linear-gradient(135deg, #00b894 0%, #55efc4 100%);
            --danger-gradient: linear-gradient(135deg, #e73f3f 0%, #fd797e 100%);
            --secondary-gradient: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            --primary-color: #6c5ce7;
            --warning-gradient: linear-gradient(135deg, #fdcb6e 0%, #f39c12 100%);
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --border-radius: 18px;
            --border-radius-lg: 28px;
            --shadow-lg: 0 8px 36px rgba(108, 92, 231, 0.18);
        }

        html[dir="rtl"] body,
        html[dir="rtl"] .container-fluid,
        html[dir="rtl"] .profile-content,
        html[dir="rtl"] #chapter-lesson-container,
        html[dir="rtl"] .modal-content {
            direction: rtl;
            text-align: right;
        }

        .questions-header {
            width: 100%;
            text-align: center;
            margin-bottom: 2.2rem;
            padding: 2rem 0 1.2rem 0;
            background: transparent;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(108,92,231,0.11);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

            .questions-header h2 {
                font-size: 2.5rem;
                font-weight: 800;
                margin-bottom: 0.3rem;
                letter-spacing: -.01em;
                background: var(--primary-gradient-horizontal);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                color: transparent;
                display: inline-block;
                text-align: center;
            }

        /* Enhanced Chapter Dropdown */
        .chapter-selector {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(108,92,231,0.11);
        }

            .chapter-selector h3 {
                color: var(--primary-color);
                margin-bottom: 1rem;
                font-weight: 600;
            }

        #chapter-dropdown {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            background: #fafbff;
            font-size: 1.1rem;
            color: #333;
            transition: all 0.3s ease;
        }

            #chapter-dropdown:focus {
                border-color: var(--primary-color);
                outline: none;
                box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
            }

        /* Enhanced Add Question Form */
        .add-question-section {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(108,92,231,0.11);
            display: none;
            /* Add smooth animation */
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

            .add-question-section.show {
                opacity: 1;
                transform: translateY(0);
            }

        /* Questions Display */
        .questions-display {
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(108,92,231,0.11);
            display: none;
        }

        .question-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

            .question-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 20px rgba(108, 92, 231, 0.15);
            }

        .question-content {
            font-size: 1.1rem;
            font-weight: 500;
            color: #333;
            margin-bottom: 1rem;
        }

        .answers-container {
            margin-top: 1rem;
        }

        .answer-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: background-color 0.2s ease;
        }

            .answer-item.correct {
                background: #d4edda;
                border-color: #c3e6cb;
                color: #155724;
            }

            .answer-item:hover {
                background: #f1f3f4;
            }

            .answer-item.correct:hover {
                background: #c8e6c9;
            }

        .question-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

            .question-form-header h3 {
                color: var(--primary-color);
                margin: 0;
                font-weight: 600;
            }

        .form-group {
            margin-bottom: 1.5rem;
        }

            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
                color: #333;
            }

        .modern-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            background: #fafbff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

            .modern-input:focus {
                border-color: var(--primary-color);
                outline: none;
                box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1);
            }

        textarea.modern-input {
            min-height: 100px;
            resize: vertical;
        }

        /* Dynamic Answers Section */
        .answers-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #f0f0f0;
        }

            .answers-section h4 {
                color: var(--primary-color);
                margin-bottom: 1.5rem;
                font-weight: 600;
            }

        .answer-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .answer-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .correct-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

            .correct-checkbox input[type="radio"] {
                width: 18px;
                height: 18px;
                accent-color: var(--primary-color);
            }

        .remove-answer-btn {
            background: var(--danger-gradient);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

            .remove-answer-btn:hover {
                transform: scale(1.1);
            }

        .add-answer-btn {
            background: var(--success-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

            .add-answer-btn:hover {
                transform: translateY(-2px);
            }

        .modern-btn {
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            border: none;
            color: #fff;
            box-shadow: 0 2px 8px rgba(108, 92, 231, 0.10);
            font-size: 1rem;
            cursor: pointer;
            margin-right: 0.5rem;
            transition: transform 0.16s, box-shadow 0.16s;
            display: inline-flex;
            align-items: center;
            gap: 0.5em;
        }

            .modern-btn.primary-btn {
                background: var(--primary-gradient);
            }

            .modern-btn.secondary-btn {
                background: var(--primary-gradient-light);
                color: var(--primary-color);
            }

            .modern-btn.success-btn {
                background: var(--success-gradient);
            }

            .modern-btn.danger-btn {
                background: var(--danger-gradient);
            }

            .modern-btn:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #f0f0f0;
        }

        /* Loading and Empty States */
        .loading-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #999;
        }

            .empty-state i {
                font-size: 3rem;
                color: #ddd;
                margin-bottom: 1rem;
            }

        /* Responsive Design */
        @@media (max-width: 768px) {
            .questions-header h2

        {
            font-size: 1.8rem;
        }

        .chapter-selector,
        .questions-display,
        .add-question-section {
            padding: 1rem;
        }

        .answer-group {
            flex-direction: column;
            align-items: stretch;
            gap: 0.5rem;
        }

        .correct-checkbox {
            justify-content: center;
        }

        .form-actions {
            flex-direction: column;
        }

        .modern-btn {
            width: 100%;
            justify-content: center;
        }

        }
    </style>
</head>
<body>
    <div class="questions-header">
        <h2>
            <i class="fa-solid fa-book-open-reader"></i>
            @Localizer["Questions"]
        </h2>
    </div>

    <div id="js-localization"
         data-search-placeholder="@Localizer["SearchPlaceholder"]"
         data-chapter-name="@Localizer["ChapterName"]"
         data-select-chapter="@Localizer["SelectChapter"]"
         data-no-chapters="@Localizer["NoChapters"]"
         data-loading="@Localizer["Loading"]"
         data-add-question="@Localizer["AddQuestion"]"
         data-question-content="@Localizer["QuestionContent"]"
         data-answers="@Localizer["Answers"]"
         data-add-answer="@Localizer["AddAnswer"]"
         data-remove-answer="@Localizer["RemoveAnswer"]"
         data-correct-answer="@Localizer["CorrectAnswer"]"
         data-save="@Localizer["Save"]"
         data-cancel="@Localizer["Cancel"]"
         data-processing="@Localizer["Processing"]"
         data-saved="@Localizer["Saved"]"
         data-error-occurred="@Localizer["ErrorOccurred"]"
         data-please-fill-all-fields="@Localizer["PleaseFillAllFields"]"
         data-select-correct-answer="@Localizer["SelectCorrectAnswer"]"
         data-add-at-least-one-answer="@Localizer["AddAtLeastOneAnswer"]"
         data-no-questions="@Localizer["NoQuestions"]"
         data-edit="@Localizer["Edit"]"
         data-delete="@Localizer["Delete"]"
         data-enter-question-content="@Localizer["EnterQuestionContent"]"
         data-answer-content="@Localizer["AnswerContent"]"
         data-correct="@Localizer["Correct"]" />

    <div class="container-fluid">
        <!-- Chapter Selector -->
        <div class="chapter-selector">
            <h3><i class="fas fa-book"></i> @Localizer["SelectChapter"]</h3>
            <select id="chapter-dropdown" class="form-select">
                <option value="">@Localizer["SelectChapter"]...</option>
            </select>
        </div>

        <!-- MOVED: Add Question Form - Now appears right after chapter selector -->
        <div id="add-question-section" class="add-question-section">
            <div class="question-form-header">
                <h3><i class="fas fa-plus-circle"></i> @Localizer["AddQuestion"]</h3>
                <button id="close-question-form" class="modern-btn secondary-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="question-form">
                <div class="form-group">
                    <label for="question-content-input">
                        @Localizer["QuestionContent"] <span style="color: red;">*</span>
                    </label>
                    <textarea id="question-content-input" class="modern-input" rows="4"
                              placeholder="@Localizer["EnterQuestionContent"]"></textarea>
                </div>

                <div class="answers-section">
                    <h4><i class="fas fa-list"></i> @Localizer["Answers"]</h4>
                    <div id="answers-container">
                        <!-- Initial answer fields -->
                        <div class="answer-group" data-answer-index="0">
                            <input type="text" class="answer-input" placeholder="@Localizer["AnswerContent"]" required>
                            <div class="correct-checkbox">
                                <input type="radio" name="correct-answer" value="0" id="correct-0">
                                <label for="correct-0">@Localizer["Correct"]</label>
                            </div>
                            <button type="button" class="remove-answer-btn" onclick="removeAnswer(0)" style="display: none;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>

                        <div class="answer-group" data-answer-index="1">
                            <input type="text" class="answer-input" placeholder="@Localizer["AnswerContent"]" required>
                            <div class="correct-checkbox">
                                <input type="radio" name="correct-answer" value="1" id="correct-1">
                                <label for="correct-1">@Localizer["Correct"]</label>
                            </div>
                            <button type="button" class="remove-answer-btn" onclick="removeAnswer(1)" style="display: none;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <button type="button" id="add-answer-btn" class="add-answer-btn">
                        <i class="fas fa-plus"></i> @Localizer["AddAnswer"]
                    </button>
                </div>

                <div class="form-actions">
                    <button type="button" id="cancel-question-btn" class="modern-btn secondary-btn">
                        <i class="fas fa-times"></i> @Localizer["Cancel"]
                    </button>
                    <button type="submit" id="save-question-btn" class="modern-btn primary-btn">
                        <i class="fas fa-save"></i> @Localizer["Save"]
                    </button>
                </div>

                <div id="question-message" class="mt-3"></div>
            </form>
        </div>

        <!-- Questions Display -->
        <div id="questions-display" class="questions-display">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 id="selected-chapter-title"><i class="fas fa-question-circle"></i> @Localizer["Questions"]</h3>
                <button id="add-question-btn" class="modern-btn primary-btn">
                    <i class="fas fa-plus"></i> @Localizer["AddQuestion"]
                </button>
            </div>
            <div id="questions-container">
                <!-- Questions will be loaded here -->
            </div>
        </div>
    </div>

    @section Scripts {
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="~/js/Question.js"></script>
    }
</body>
</html>