@{
    ViewData["Title"] = "Content";
}

<style>
    /* Layout & spacing improvements */
    #widgetBox .widget-body {
        padding-bottom: 4rem; /* leave space so content not hidden behind sticky bar */
    }

    .color-input-wrapper small.form-text {
        font-size: 11px;
    }

    /* Sticky action bar */
    .action-bar-bottom {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: #ffffffee;
        backdrop-filter: blur(4px);
        border-top: 1px solid #ddd;
        padding: .75rem 1.25rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 1030;
        transition: transform .25s ease;
    }

    .action-bar-bottom.hidden {
        transform: translateY(110%);
    }

    .action-bar-bottom .info {
        font-size: 0.85rem;
        color: #666;
        display: flex;
        gap: 1.25rem;
        flex-wrap: wrap;
    }

    .action-bar-bottom .btn-primary:disabled {
        opacity: .6;
        cursor: not-allowed;
    }

    .fade-in {
        animation: fadeIn .35s ease;
    }
    /* Use @@ to escape  inside Razor view */
    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(8px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Optional nicer header spacing */
    #top .widget-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: .75rem;
    }

    /* Responsive tweaks */
    @@media (max-width: 768px) {
        .action-bar-bottom {
            flex-direction: column;
            align-items: stretch;
            gap: .75rem;
        }

        .action-bar-bottom .info {
            width: 100%;
            justify-content: space-between;
        }

        #widgetBox .widget-body {
            padding-bottom: 6rem;
        }
    }
</style>

<div id="top" class="banner-style-two banner-bg">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div id="widgetBox" class="widget-box">
                    <div class="widget-header widget-header-flat">
                        <h4 class="widget-title lighter m-0">Content</h4>
                        <div class="d-flex align-items-center gap-2">
                            <button onclick="toggleFullScreen()" class="btn btn-sm btn-primary">
                                🔄 Full Screen
                            </button>
                        </div>
                    </div>

                    <div class="widget-body">

                        <!-- Root Filter & Column selectors -->
                        <div class="row g-3" style="padding: 1em 1em 0 1em;">
                            <div class="col-md-3">
                                <label for="gymFilter" class="form-label fw-semibold small text-uppercase text-muted">Root Filter</label>
                                <select id="gymFilter" class="form-control">
                                    <option value="all">All Roots</option>
                                    <option value="center">Centers Only</option>
                                    <option value="noncenter">Non-Centers Only</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="gym" class="form-label fw-semibold small text-uppercase text-muted">Root</label>
                                <select id="gym" class="form-control select2 form-mob" style="width: 100%"></select>
                            </div>
                            <div class="col-md-4">
                                <label for="column" class="form-label fw-semibold small text-uppercase text-muted">Content Column</label>
                                <select id="column" class="form-control select2 form-mob" style="width: 100%;"></select>
                            </div>
                        </div>

                        <!-- Root Colors -->
                        <div class="row fade-in" id="rootColorsRow" style="padding: 1.25em 1em 0 1em; display:none;">
                            <div class="col-sm-12">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 class="mb-0">Root Colors</h5>
                                    <small class="text-muted">Enter hex colors (#RRGGBB or #RGB)</small>
                                </div>
                                <div id="rootColorsInputs" class="row">
                                    <!-- Color inputs injected via JS -->
                                </div>
                            </div>
                        </div>

                        <!-- Editor -->
                        <div class="row" style="padding: 1.25em 1em 0 1em;">
                            <div class="col-sm-12">
                                <label for="content" class="form-label fw-semibold small text-uppercase text-muted">
                                    HTML Content
                                </label>
                                <textarea id="content" name="content"></textarea>
                            </div>
                        </div>

                        <!-- Spacer so bottom bar doesn't overlap -->
                        <div style="height: 90px;"></div>

                    </div><!-- /widget-body -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sticky action bar (Save at end of page) -->
<div id="actionBar" class="action-bar-bottom hidden">
    <div class="info">
        <span id="selectedRootInfo">No root selected</span>
        <span id="selectedColumnInfo">No column selected</span>
    </div>
    <div class="d-flex align-items-center gap-2">
        <button id="save" type="button" class="btn btn-success">
            <span class="save-text">💾 Save Changes</span>
        </button>
    </div>
</div>

@section scripts
{
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/htmlmixed/htmlmixed.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Ensure this JS version includes the gymFilter logic -->
    <script src="/Js/Content.js?v=5"></script>
    <script>
        function updateActionBarState() {
            var gymVal = $('#gym').val();
            var colVal = $('#column').val();
            var $bar = $('#actionBar');

            if (gymVal && gymVal !== "0") {
                $bar.removeClass('hidden');
                $('#selectedRootInfo').text('Root: ' + $('#gym option:selected').text());
            } else {
                $bar.addClass('hidden');
                $('#selectedRootInfo').text('No root selected');
            }

            if (colVal && colVal !== "0") {
                $('#selectedColumnInfo').text('Column: ' + $('#column option:selected').text());
            } else {
                $('#selectedColumnInfo').text('No column selected');
            }
        }

        $(document).on('change', '#gym, #column', updateActionBarState);
        setTimeout(updateActionBarState, 800);
    </script>
}